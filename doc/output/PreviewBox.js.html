<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: desktop/PreviewBox.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: desktop/PreviewBox.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
* @class PreviewBox
*/
enyo.kind(
/** @lends PreviewBox.prototype */
{
    kind: enyo.Control,
    name: 'PreviewBox',

    published: {
        menu: null
    },

    create: function(){
        this.inherited(arguments);
        this.createMenu();
        this.$.openedDoc.hide();
        this.hideRateButtons();
    },

    /**
     * This function creates the entity menu, which will be showed when the user
     * select a text in the preview document and after this click with the right
     * click.
     */
    createMenu: function(){
        /**
        * @class MenuController
        */
        enyo.kind(
        /** @lends MenuController.prototype */
        { 
            kind: enyo.Control,
            name: 'MenuController',
            classes: 'entityMenu',
            
            published: {
                clickTop: null,
                clickLeft: null,
                selectedText: ''
            },

            components: [
                { kind: 'DynamicMenu', name: 'entityMenu',
                    menuItemClass: 'entityMenuItem', menuItems: [
                        { label: 'Add entity', functionName: 'addEntity' },
                        { label: 'Remove entity', functionName: 'removeEntity' },
                        { label: 'Move entity', functionName: 'moveEntity' }
                    ]
                },
                {
                    kind: 'AddEntityPopup',
                    name: 'addEntityPopup',
                    classes: 'addEntityPopup',
                    titleContent: 'Add entity: ',
                    okButtonContent: 'OK',
                    cancelButtonContent: 'Cancel'
                },
                {
                    kind: 'RemoveEntityPopup',
                    name: 'removeEntityPopup',
                    classes: 'removeEntityPopup',
                    titleContent: 'Remove entity: ',
                    okButtonContent: 'OK',
                    cancelButtonContent: 'Cancel'
                },
                {
                    kind: 'MoveEntityPopup',
                    name: 'moveEntityPopup',
                    classes: 'moveEntityPopup',
                    titleContent: 'Move entity: ',
                    fromContent: 'From:',
                    toContent: 'From:',
                    okButtonContent: 'OK',
                    cancelButtonContent: 'Cancel'
                }
            ],

            /**
             * This function is called when the user push the "Add entity" menu
             * item. The addEntityPopup will be showed with the selected text.
             */
            addEntity: function(){
                this.hideMenu();
                this.$.addEntityPopup.addEntity(this.selectedText);
            },

            /**
             * This function is called when the user push the "Remove entity" menu
             * item. The removeEntityPopup will be showed with the selected text.
             */
            removeEntity: function(){
                this.hideMenu();
                this.$.removeEntityPopup.removeEntity(this.selectedText);
            },

            /**
             * This function is called when the user push the "Move entity" menu
             * item. The moveEntityPopup will be showed with the selected text.
             */
            moveEntity: function(){
                this.hideMenu();
                this.$.moveEntityPopup.moveEntity(this.selectedText);
            },

            /**
             * This function show the entity menu to the mouse position.
             * @param {Object} inEvent the event which contains the position of the mouse
             * @param {String} selectedText the selected text what the user selected
             */
            showMenu: function(inEvent, selectedText){
                this.selectedText = selectedText;
                this.clickTop = inEvent.pageY;
                this.clickLeft = inEvent.pageX;

                // Menu's and window's width and height
                var jQMenu = jQuery('#' + this.$.entityMenu.getId());
                var jQDoc = jQuery(document);
                var menuWidth = jQMenu.width();
                var menuHeight = jQMenu.height();
                var windowWidth = jQDoc.width();
                var windowHeight = jQDoc.height();

                // Overflow on the right side
                var newX = this.clickLeft;
                if(windowWidth - this.clickLeft &lt; menuWidth){
                    newX = this.clickLeft - menuWidth;
                }

                // Overflow on the bottom
                var newY = this.clickTop;
                if(windowHeight - this.clickTop &lt; menuHeight){
                    newY = this.clickTop - menuHeight;
                }

                // Set the position and showing
                this.applyStyle('top', newY + 'px');
                this.applyStyle('left', newX + 'px');
                this.$.entityMenu.show();
            },

            /**
             * This function hide the entity menu.
             */
            hideMenu: function(){
                this.$.entityMenu.hide();
            }

        });
        this.menu = new MenuController();
        this.menu.renderInto(document.getElementById('menu'));
        this.menu.hideMenu();
    },

    components: [
        {
            kind: 'OpenedDoc',
            name: 'openedDoc',
            ondown: 'clickText',
            classes: 'openedDocument',
            documentContentClass: 'documentContent',
            noDataLabel: 'No data available',
            loaderClass: 'loader'
        },
        { tag: 'div', name: 'posRateButton', classes: 'positiveRateButton', ontap: 'positiveRate' },
        { tag: 'div', name: 'negRateButton', classes: 'negativeRateButton', ontap: 'negativeRate' },
        { tag: 'div', name: 'fullViewButton', classes: 'fullViewButton', ontap: 'fullView' },
        {
            kind: 'RatePopup',
            name: 'ratePopup',
            classes: 'ratePopup',
            positiveLabel: 'Rate to positive',
            negativeLabel: 'Rate to negative',
            placeholderText: 'Category name...',
            rateContentClass: 'rateContent',
            inputFrameClass: 'searchLabel',
            okButtonClass: 'okRateButton'
        }
    ],

    /**
     * This function changes the height of the opened document.
     * @param {Number} newHeight the document's new height
     */
    changeHeight: function(newHeight){
        this.$.openedDoc.changeHeight(newHeight);
    },

    /**
     * This function runs when the user click on the previewed document. If the
     * popup menu exists and the user clicked with right button, and the
     * selected text length's is good the entity menu will be showed. If the user
     * click with other button (and the menu exists) the entity menu will be hided.
     * @param {Object} inSender the previewed document
     * @param {Object} inEvent the event which contains information about the mouse
     */
    clickText: function(inSender, inEvent){
        if(!isEmpty(this.menu)){
            if(inEvent.which === 3){
                var selectedText = this.$.openedDoc.getSelectedText();
                if(textLengthBetween(selectedText, 1, 50)){
                    this.menu.showMenu(inEvent, selectedText);
                }
            } else {
                this.menu.hideMenu();
            }
        }
    },            

    /**
     * This function runs when the user push the "positive rate" button. It shows
     * the rate popup with true (positive) parameter.
     */
    positiveRate: function(){
        this.$.ratePopup.showPopup(true);
    },

    /**
     * This function runs when the user push the "negative rate" button. It shows
     * the rate popup with false (negative) parameter.
     */
    negativeRate: function(){
        this.$.ratePopup.showPopup(false);
    },

    /**
     * This function runs when the user push the "full view" button.
     */
    fullView: function(){
        alert('Full view function is coming soon...');
    },

    /**
     * This function hides the positive and negative rate buttons and the full
     * view button.
     */
    hideRateButtons: function(){
        this.$.posRateButton.hide();
        this.$.negRateButton.hide();
        this.$.fullViewButton.hide();
    },

    /**
     * This function shows the positive and negative rate buttons and the full
     * view button.
     */
    showRateButtons: function(){
        this.$.posRateButton.show();
        this.$.negRateButton.show();
        this.$.fullViewButton.show();
    },

    /**
     * This function call the opened doc's openDoc function and shows the buttons.
     * @param {Object} previewDoc the previewed document
     */
    openDoc: function(previewDoc){
        this.$.openedDoc.openDoc(previewDoc);
        this.$.openedDoc.show();
        this.showRateButtons();
    },

    /**
     * This function returns with the opened document id in the DOM.
     * @return {String} the id
     */
    getOpenDocId: function(){
        return this.$.openedDoc.getId();
    },

    /**
     * This function returns with opened document's document URL.
     * @return {String} the URL
     */
    getDocumentURL: function(){
        return this.$.openedDoc.getDocumentURL();
    }

});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="AutoSuggest.html">AutoSuggest</a></li><li><a href="Bookmark.html">Bookmark</a></li><li><a href="ClosablePopup.html">ClosablePopup</a></li><li><a href="DetailsBox.html">DetailsBox</a></li><li><a href="Dictionary.html">Dictionary</a></li><li><a href="DictionaryEntity.html">DictionaryEntity</a></li><li><a href="DictionaryList.html">DictionaryList</a></li><li><a href="DocumentApp.html">DocumentApp</a></li><li><a href="DocumentList.html">DocumentList</a></li><li><a href="DocumentMobileApp.html">DocumentMobileApp</a></li><li><a href="DynamicMenu.html">DynamicMenu</a></li><li><a href="LeftHeader.html">LeftHeader</a></li><li><a href="LeftPanel.html">LeftPanel</a></li><li><a href="LoginPopup.html">LoginPopup</a></li><li><a href="MenuController.html">MenuController</a></li><li><a href="MiddlePanel.html">MiddlePanel</a></li><li><a href="OpenedDoc.html">OpenedDoc</a></li><li><a href="OpenedDocHeader.html">OpenedDocHeader</a></li><li><a href="PreviewBox.html">PreviewBox</a></li><li><a href="RightPanel.html">RightPanel</a></li><li><a href="SearchBox.html">SearchBox</a></li><li><a href="ShortDocument.html">ShortDocument</a></li><li><a href="TopMessageBox.html">TopMessageBox</a></li></ul><h3>Global</h3><ul><li><a href="global.html#GetURLParameter">GetURLParameter</a></li><li><a href="global.html#isEmpty">isEmpty</a></li><li><a href="global.html#replaceAll">replaceAll</a></li><li><a href="global.html#textLengthBetween">textLengthBetween</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Thu Jun 06 2013 08:35:22 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
