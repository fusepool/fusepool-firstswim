<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>desktop\LoginPopup.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AutoSuggest.html">AutoSuggest</a></li>
            
                <li><a href="../classes/Bookmark.html">Bookmark</a></li>
            
                <li><a href="../classes/ClosablePopup.html">ClosablePopup</a></li>
            
                <li><a href="../classes/DetailsBox.html">DetailsBox</a></li>
            
                <li><a href="../classes/Dictionary.html">Dictionary</a></li>
            
                <li><a href="../classes/DictionaryController.html">DictionaryController</a></li>
            
                <li><a href="../classes/DictionaryEntity.html">DictionaryEntity</a></li>
            
                <li><a href="../classes/DocumentApp.html">DocumentApp</a></li>
            
                <li><a href="../classes/DocumentList.html">DocumentList</a></li>
            
                <li><a href="../classes/DocumentMobileApp.html">DocumentMobileApp</a></li>
            
                <li><a href="../classes/DynamicMenu.html">DynamicMenu</a></li>
            
                <li><a href="../classes/LabelItem.html">LabelItem</a></li>
            
                <li><a href="../classes/LabelList.html">LabelList</a></li>
            
                <li><a href="../classes/Landscape.html">Landscape</a></li>
            
                <li><a href="../classes/LeftHeader.html">LeftHeader</a></li>
            
                <li><a href="../classes/LeftPanel.html">LeftPanel</a></li>
            
                <li><a href="../classes/LocationViewer.html">LocationViewer</a></li>
            
                <li><a href="../classes/LoginPopup.html">LoginPopup</a></li>
            
                <li><a href="../classes/MenuController.html">MenuController</a></li>
            
                <li><a href="../classes/MiddlePanel.html">MiddlePanel</a></li>
            
                <li><a href="../classes/NGraph.html">NGraph</a></li>
            
                <li><a href="../classes/OpenedDoc.html">OpenedDoc</a></li>
            
                <li><a href="../classes/OpenedDocHeader.html">OpenedDocHeader</a></li>
            
                <li><a href="../classes/PredicateAnnotator.html">PredicateAnnotator</a></li>
            
                <li><a href="../classes/PredicateItem.html">PredicateItem</a></li>
            
                <li><a href="../classes/PreviewBox.html">PreviewBox</a></li>
            
                <li><a href="../classes/RightPanel.html">RightPanel</a></li>
            
                <li><a href="../classes/SearchBox.html">SearchBox</a></li>
            
                <li><a href="../classes/ShortDocument.html">ShortDocument</a></li>
            
                <li><a href="../classes/TopMessageBox.html">TopMessageBox</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Firstswim.html">Firstswim</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: desktop\LoginPopup.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
* @class LoginPopup
*/
enyo.kind(
/** @lends LoginPopup.prototype */
{
    kind: enyo.Control,
    name: &#x27;LoginPopup&#x27;,
    classes: &#x27;loginPopup&#x27;,

    published: {
        realSignUp: false // change the field or real sign up query to server
    },

    create: function(){
        this.inherited(arguments);
		this.initLogin();
    },
  
    components: [
        { name: &#x27;popup&#x27;, classes: &#x27;loginPopupDiv&#x27;, kind: onyx.Popup, onHide: &#x27;close&#x27;, components: [
            { tag: &#x27;table&#x27;, name: &#x27;loginTable&#x27;, classes: &#x27;loginTable&#x27;, components: [
                { tag: &#x27;tr&#x27;, components: [
                    { tag: &#x27;td&#x27;, classes: &#x27;loginTableLeftCol&#x27;, content: &#x27;Username: &#x27; },
                    { tag: &#x27;td&#x27;, components: [{ name: &#x27;usernameInput&#x27;, kind: enyo.Input }]}
                ]},
                { tag: &#x27;tr&#x27;, classes: &#x27;loginTableLeftCol&#x27;, name: &#x27;emailRow&#x27;, components: [
                    { tag: &#x27;td&#x27;, content: &#x27;E-mail address: &#x27; },
                    { tag: &#x27;td&#x27;, components: [{ name: &#x27;email&#x27;, kind: enyo.Input }]}
                ]},
                { tag: &#x27;tr&#x27;, components: [
                    { tag: &#x27;td&#x27;, classes: &#x27;loginTableLeftCol&#x27;, content: &#x27;Password: &#x27; },
                    { tag: &#x27;td&#x27;, components: [{ name: &#x27;passwordInput&#x27;, type: &#x27;password&#x27;, kind: enyo.Input, onkeydown: &#x27;onKeydown&#x27; }]}
                ]},
                { tag: &#x27;tr&#x27;, name: &#x27;passwordConfirmRow&#x27;, components: [
                    { tag: &#x27;td&#x27;, classes: &#x27;loginTableLeftCol&#x27;, content: &#x27;Password confirm: &#x27; },
                    { tag: &#x27;td&#x27;, components: [{ name: &#x27;passwordConfirmInput&#x27;, type: &#x27;password&#x27;, kind: enyo.Input }]}
                ]}
            ]},
            { tag: &#x27;div&#x27;, classes: &#x27;currentUserLabel&#x27;, name: &#x27;currentUserLabel&#x27;, allowHtml: true },
            { tag: &#x27;div&#x27;, classes: &#x27;loginMessage&#x27;, name: &#x27;loginMessage&#x27; },
            { tag: &#x27;div&#x27;, classes: &#x27;loginButtons&#x27;, components: [
				{ kind: &#x27;onyx.Button&#x27;, content: &#x27;Sign out&#x27;, name: &#x27;signOutBtn&#x27;, classes: &#x27;signOutBtn&#x27;, ontap:&quot;signOut&quot;},
				{ kind: &#x27;onyx.Button&#x27;, content: &#x27;Back&#x27;, name: &#x27;loginBackBtn&#x27;, classes: &#x27;loginBackBtn&#x27;, ontap:&quot;back&quot;},
				{ kind: &#x27;onyx.Button&#x27;, content: &#x27;Sign in&#x27;, name: &#x27;signInBtn&#x27;, classes: &#x27;signInBtn&#x27;, ontap:&quot;signIn&quot;},
				{ kind: &#x27;onyx.Button&#x27;, content: &#x27;Register&#x27;, name: &#x27;signUpBtn&#x27;, classes: &#x27;signUpBtn&#x27;, ontap:&quot;signUp&quot;}
            ]}
        ]},
        { name: &#x27;closeButton&#x27;, ontap: &#x27;close&#x27;, classes: &#x27;loginCloseButton&#x27; }
    ],
	
	/**
	 * This function initializes the login panel based on the cookie values.
	 * @method initLogin
	 */
    initLogin: function(){
		if(readCookie(&#x27;currentUser&#x27;) == &#x27;anonymous&#x27;) {
			this.$.emailRow.hide();
			this.$.passwordConfirmRow.hide();
			this.$.signOutBtn.hide();
			this.hideCurrentUser();
		}
		else {
			this.$.signInBtn.hide();
			this.$.signUpBtn.hide();
			this.$.loginTable.hide();
			this.showCurrentUser(&#x27;Signed in as &lt;b&gt;&#x27;+readCookie(&#x27;currentUser&#x27;)+&#x27;&lt;/b&gt;.&#x27;);
			this.owner.$.loginButton.removeClass(&#x27;loggedOut&#x27;);
			this.owner.$.loginButton.addClass(&#x27;loggedIn&#x27;);
		}
		this.hideLoginMessage();
		this.$.loginBackBtn.hide();
        this.close();
	},
	
	/**
	 * This function is called when the user clicks on &#x27;Sign out&#x27;.
	 * It hides and shows the proper panels and sets the cookie value.
	 * @method signOut
	 */
	signOut: function(){
		createCookie(&#x27;currentUser&#x27;, &#x27;anonymous&#x27;, 30);	
		this.hideCurrentUser();
		
		this.$.loginTable.show();
		this.$.signInBtn.show();
		this.$.signUpBtn.show();
		
		this.$.emailRow.hide();
		this.$.passwordConfirmRow.hide();
		this.$.signOutBtn.hide();
		this.$.loginBackBtn.hide();
		
		this.owner.$.loginButton.removeClass(&#x27;loggedIn&#x27;);
		this.owner.$.loginButton.addClass(&#x27;loggedOut&#x27;);
	},
	
    /**
     * This function is called when the tap the &#x27;Back&#x27; button on the registration
     * popup hide the registration&#x27;s components and shows the login&#x27;s componens.
	 * @method back
     */
    back: function(){
        this.$.loginBackBtn.hide();
        this.$.signInBtn.show();
        this.$.emailRow.hide();
        this.$.passwordConfirmRow.hide();
        this.realSignUp = false;
		this.hideLoginMessage();
    },

    /**
     * This function runs when the user clicks on &#x27;Sign In&#x27;. It starts
	 * a request to the server and based on the response, it either
	 * calls the &#x27;signInFailed&#x27; or the &#x27;signInSucceed&#x27; function.
	 * @method signIn
     */
    signIn: function(){
		this.hideLoginMessage();
		var main = this;
		var name = this.$.usernameInput.getValue();
		var pw = this.$.passwordInput.getValue();
		var sendOBJ = { userName: name, password: pw };
		var request = new enyo.Ajax({
			method: &#x27;POST&#x27;,
			url: CONSTANTS.SIGNIN_URL,
			headers: { Accept: &#x27;text/plain&#x27;, &#x27;Content-Type&#x27; : &#x27;application/x-www-form-urlencoded&#x27;},
			handleAs: &#x27;text&#x27;,
			postBody: sendOBJ,
			published: { timeout: 60000 }
		});
		request.go();
		request.error(enyo.bind(this, function(inSender, inResponse) {
			main.signInFailed(inSender.xhrResponse.body);
		}));				
		request.response(this, function(inSender, inResponse) {
			main.signInSucceed(name, main);
		});
    },
	
    /**
     * This function runs after a successful login. It creates the proper
	 * cookie and sets the login panel to logged in state.
	 * @method signInSucceed
     */
	signInSucceed: function(userName){
		createCookie(&#x27;currentUser&#x27;,userName,30);
		this.$.loginStatus;
		this.showCurrentUser(&#x27;Signed in as &lt;b&gt;&#x27;+userName+&#x27;&lt;/b&gt;.&#x27;);
		this.hideLoginMessage();
		
		this.$.loginTable.hide();
		this.$.signInBtn.hide();
		this.$.signUpBtn.hide();
		
		this.$.signOutBtn.show();
		
		this.owner.$.loginButton.removeClass(&#x27;loggedOut&#x27;);
		this.owner.$.loginButton.addClass(&#x27;loggedIn&#x27;);
		
		getUserLabels(userName);
    },
	
    /**
     * This function runs after an unsuccessful login. It shows an error message.
	 * @method signInFailed
     */
	signInFailed: function(errorMessage){
		this.showLoginMessage(errorMessage);
    },
	
    /**
     * This function called when the tap the &quot;Sign Up&quot; button. If the registration
     * panel is active, the ajax request will be sent in the future, otherwise
     * it shows the registration&#x27;s fields.
	 * @method signUp
     */
    signUp: function(){
		this.hideLoginMessage();
        if(this.realSignUp){
            if(true) {
				if(this.validateFields()) {	
					var main = this;				
					var sendOBJ = { userName: this.$.usernameInput.getValue(), password: this.$.passwordInput.getValue(), email: this.$.email.getValue() };
					var request = new enyo.Ajax({
						method: &#x27;POST&#x27;,
						url: CONSTANTS.SELFREG_URL,
						headers: { Accept: &#x27;text/plain&#x27;, &#x27;Content-Type&#x27; : &#x27;application/x-www-form-urlencoded&#x27;},
						postBody: sendOBJ,
						published: { timeout: 60000 }
					});
					request.go();
					request.error(enyo.bind(this, function(inSender, inResponse) {
						var errorMessage = &#x27;Registration failed.&#x27;;
						var token = /\&lt;pre\&gt;(.*)\&lt;\/pre\&gt;/g;
						var regExpResult = token.exec(inSender.xhrResponse.body);
						if(!isEmpty(regExpResult)) {
							errorMessage = RegExp.$1;
						}
						main.registrationFailed(errorMessage);
					}));				
					request.response(this, function(inSender, inResponse) {
						main.registrationSucceed(true, inResponse);
					});
				}
			}
        } else {
            this.realSignUp = true;
            this.showRegisterFields();
        }
    },
	
    /**
     * This function runs after an unsuccessful registration.
	 * It shows an error message.
	 * @method registrationFailed
     */
	registrationFailed: function(errorMessage) {
		this.showLoginMessage(errorMessage);
	},
	
    /**
     * This function runs after a successful registration.
	 * It switches back the panel to login state and informs
	 * the user about the successful registration.
	 * @method registrationSucceed
     */
	registrationSucceed: function() {
		this.back();
		this.showLoginMessage(&#x27;Successful registration. Now you can sign in.&#x27;);
	},
	
    /**
     * This function validates the entered data in the fields
	 * of the registration panel.
	 * @method validateFields
     */
	validateFields: function() {
		var valid = true;
		
		var token = /^(([^&lt;&gt;()[\]\\.,;:\s@\&quot;]+(\.[^&lt;&gt;()[\]\\.,;:\s@\&quot;]+)*)|(\&quot;.+\&quot;))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
				
		if(	!token.test(this.$.email.getValue()) ||
			isEmpty(this.$.usernameInput.getValue()) ||	
			isEmpty(this.$.passwordInput.getValue()) ||
			isEmpty(this.$.passwordConfirmInput.getValue()) ||	
			this.$.passwordInput.getValue() != this.$.passwordConfirmInput.getValue() 
			) {
			valid = false;
			this.showLoginMessage(&#x27;Invalid data. Try again.&#x27;);
		}
		
		return valid;
	},
	
    /**
     * This function clears and hides the &#x27;currentUserLabel&#x27; panel.
	 * @method hideCurrentUser
     */
	hideCurrentUser: function() {
		this.$.currentUserLabel.hide();
		this.$.currentUserLabel.setContent(&#x27;&#x27;);
	},
	
    /**
     * This function displays a text in the &#x27;currentUserLabel&#x27; panel
	 * (either a username or a message about being logged out).
	 * @method showCurrentUser
     */
	showCurrentUser: function(userStatus) {
		this.$.currentUserLabel.show();
		this.$.currentUserLabel.setContent(userStatus);
	},
	
    /**
     * This function hides the current message in the panel.
	 * @method hideLoginMessage
     */
	hideLoginMessage: function() {
		this.$.loginMessage.hide();
		this.$.loginMessage.setContent(&#x27;&#x27;);
	},
	
    /**
     * This function shows a message.
	 * @method showLoginMessage
     */
	showLoginMessage: function(message) {
		this.$.loginMessage.show();
		this.$.loginMessage.setContent(message);
	},
	
    /**
     * This function calls the &#x27;signIn&#x27; function when the user
	 * presses Enter in the login panel.
	 * @method onKeydown
     */
	onKeydown: function(inSender, inEvent) {
		if(!this.realSignUp) {
			switch(inEvent.keyCode) {
				case 13:	// Enter
					this.signIn();
					break;
			}
		}
	},

    /**
     * This function shows all fields of the registration.
	 * @method showRegisterFields
     */
    showRegisterFields: function(){
        this.$.loginBackBtn.show();
        this.$.signInBtn.hide();
        this.$.emailRow.show();
        this.$.passwordConfirmRow.show();
    },

    /**
     * This function shows the login panel.
	 * @method showLogin
     */
    showLogin: function(){
        this.$.popup.show();
        this.$.closeButton.show();
        this.show();
    },

    /**
     * This function runs when the user clicks out of the popup or to the close
     * button. It hides the whole popup.
	 * @method close
     */
    close: function(){
		this.hideLoginMessage();
        this.hide();
        this.$.closeButton.hide();
    }    

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
